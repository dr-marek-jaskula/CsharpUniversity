## Entity Framework Core University

This is a Entity Framework Core tutorial with many separated models and configurations.
Comments are used in much intense, even if in a commercial application they should be only used if there is no other way to improve code readability.

## Class library project

In order to create a separate project that deals with database, we need to:
- create new "Class Library" project
- install: Microsoft.EntityFrameworkCore.SqlServer or MySql.EntityFrameworkCore, Microsoft.EntityFrameworkCore.Design (for migrations), Microsoft.Extensions.Configuration.Json (for appsettings)
- add appsettings.json
- set appsettings.json properties to "Copy if newer" (or always copy)
- install the latest version of [dotnet ef](https://www.nuget.org/packages/dotnet-ef/):
> dotnet tool install --global dotnet-ef --version 6.0.3
or update to last version
> dotnet tool update --global dotnet-ef --version 6.0.3
- add DbContext (in this project it is called "MyDbContext")
- add data context factory, here called "MyDbContextFactory"
- add the connection string to the appsettings.json:
	- to connect to MySql: "Server=localhost;Database=CedrusMechanic;Uid=root;Pwd=DataBase;"
	- to connect to MS Sql Server: "Server=(localdb)\\MSSQLLocalDB;Database=ShareForFuture;Trusted_Connection=True"

If we are using MS SQL Server we can open "SQL Server Object Explorer" and "Server Explorer" to get for example the connection string
Check local dbs:
> sqllocaldb i

Get info about specified local db:
> sqllocaldb i MSSQLLocalDB  

Create a new local db called "dev" (it will make a new local db with newest version). Use if there is a need.
> sqllocaldb c dev 

Check in Azure Data Studio the connection:
> (localdb)\dev

- create data models
- configure data models
	- check "Review" configuration to see DefaultValues and .ValueGeneratedOnAddOrUpdate() - Generate value when the update is made and when data is added
	- check "Role" configuration to see inserting static data (that are not related to other)
- Open the power shell (or other CLI), we go to directory where there internal class library is and then:
> dotnet ef migrations add Init
where "Init" is the migration name

If we want to see the SQL statement that is generated by the migrations we can use:
> dotnet ef migrations script --output migrate.sql
This will generate the file **migrate.sql** in which all SQL statements are present

- apply migrations to the database by:
> dotnet ef database update

## Revert migrations

To revert lastly applied migrations:
> dotnet ef database update <previous-migration-name>

To revert all migrations
> dotnet ef database update 0
> dotnet ef migrations remove
and delete migrations folder

## Additional informations

To fill the table with random data use Bogus NuGet Package 

To read more about data models go to: DataModelsReadMe.md

To read more about EF Core features, performance issues (for instance bulkUpdates, safe raw sql interpolation) and traps, go to: EF Core advance 

To use DateOnly instead of DateTime see "Helpers" (Person, User) classes